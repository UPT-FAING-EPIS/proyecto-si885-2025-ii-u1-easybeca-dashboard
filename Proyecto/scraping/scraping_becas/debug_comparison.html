<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Comparación</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Debug Comparación</h1>
        
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-success" id="exactMatches">-</h3>
                        <p class="card-text">Coincidencias Exactas</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-warning" id="partialMatches">-</h3>
                        <p class="card-text">Coincidencias Parciales</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-info" id="newBecas">-</h3>
                        <p class="card-text">Nuevas Becas</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-danger" id="missingBecas">-</h3>
                        <p class="card-text">Becas Faltantes</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-info" id="status">Cargando...</div>
        <div class="alert alert-danger" id="errors" style="display: none;"></div>
        
        <pre id="rawData" style="background: #f8f9fa; padding: 15px; border-radius: 5px;"></pre>
    </div>
    
    <script>
        let comparisonData = null;
        
        async function runComparison() {
            try {
                document.getElementById('status').textContent = 'Ejecutando comparación...';
                console.log('Iniciando comparación...');
                
                const response = await fetch('/api/compare');
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    comparisonData = await response.json();
                    console.log('Datos recibidos:', comparisonData);
                    
                    document.getElementById('rawData').textContent = JSON.stringify(comparisonData, null, 2);
                    
                    updateComparisonMetrics();
                    document.getElementById('status').textContent = 'Comparación completada exitosamente';
                    document.getElementById('status').className = 'alert alert-success';
                } else {
                    throw new Error('Error al ejecutar comparación: ' + response.statusText);
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errors').textContent = 'Error: ' + error.message;
                document.getElementById('errors').style.display = 'block';
                document.getElementById('status').textContent = 'Error en comparación';
                document.getElementById('status').className = 'alert alert-danger';
            }
        }
        
        function updateComparisonMetrics() {
            if (!comparisonData) {
                console.error('No hay datos de comparación');
                return;
            }
            
            console.log('Actualizando métricas...');
            
            // Actualizar métricas principales
            const exactMatches = comparisonData.exact_matches_count || 0;
            const partialMatches = comparisonData.partial_matches_count || 0;
            const newBecas = comparisonData.new_entries ? comparisonData.new_entries.length : 0;
            const missingBecas = comparisonData.missing_entries ? comparisonData.missing_entries.length : 0;
            
            console.log('Valores:', { exactMatches, partialMatches, newBecas, missingBecas });
            
            document.getElementById('exactMatches').textContent = exactMatches;
            document.getElementById('partialMatches').textContent = partialMatches;
            document.getElementById('newBecas').textContent = newBecas;
            document.getElementById('missingBecas').textContent = missingBecas;
            
            console.log('Métricas actualizadas');
        }
        
        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado, ejecutando comparación...');
            runComparison();
        });
    </script>
</body>
</html>